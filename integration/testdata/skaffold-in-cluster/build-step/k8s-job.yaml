apiVersion: v1
kind: Pod
metadata:
  name: skaffold-in-cluster
spec:
    serviceAccountName: admin-serviceaccount
    containers:
    - name: skaffold-in-cluster
      image: gcr.io/k8s-skaffold/skaffold-in-cluster-builder
      command: ["/usr/bin/skaffold"]
      args: ["build", "--cache-artifacts=false", "-p", "build-target", "-n", "$(POD_NAMESPACE)", "-v", "debug"]
      imagePullPolicy: Always
      env:
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
    imagePullSecrets:
      - name: e2esecret
    restartPolicy: Never
